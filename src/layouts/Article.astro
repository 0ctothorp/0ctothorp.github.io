---
import { SITE_DESCRIPTION, SITE_TITLE } from "../consts";
import BaseHead from "../components/BaseHead.astro";
import Footer from "../components/Footer.astro";
import '../main.css';

export interface Props {
  title?: string;
  description?: string;
  headings: object;
}

const { title = SITE_TITLE, description = SITE_DESCRIPTION, headings } = Astro.props;

type Heading = { depth: number; headings?: Array<Heading>; slug: string; text: string };

const headingsArr = headings as Array<Heading>;
  
headingsArr.forEach(heading => { heading.headings = []; });

const toc: Heading[] = [headingsArr[0]!]

for(let i = 1; i < headingsArr.length; i++) {
  const heading = headingsArr[i]!;
  let parent = toc.at(-1)!;
  while(heading.depth - 1> parent.depth) {
    parent = parent.headings!.at(-1)!;
  }
  parent.headings!.push(heading);
}

---

<!DOCTYPE html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} />
  </head>
  <body class="bg-[#0a0908] text-slate-300">
    <main class="w-11/12 m-auto py-10 space-y-8 sm:text-lg">
      <header>
        <span class="bg-gradient-to-r from-yellow-400 to-indigo-600 bg-clip-text text-xl"><a href="/" class="text-transparent">kamilkaminski.dev</a></span>
      </header>
      <div class="flex gap-2">
        <div class="flex-shrink basis-full"><slot /></div>
        <div class="flex-grow-0 basis-36 flex-shrink-0">
          <ul>
            {
              toc[0]!.headings!.map(heading => {
                return <li><a href={`#${heading.slug}`}>{heading.text}</a></li>
              })
            }
          </ul>
        </div>
      </div>
    </main>
    <Footer />
  </body>
</html>
